---
# Networking configuration for PXE node 3
# This file contains host-specific variables for PXE node 3.

configure_network: true # Enable or disable network configuration.

# Set the primary network interface for PXE node 3.
pve_primary_nic: eno1

# Ceph configuration
pve_ceph_enabled: true # Enable or disable Ceph configuration.
pve_ceph_nic: enx00e04c68080c # Network interface for Ceph communication.
pve_ceph_nic_ip: "{{ pxenode3_ceph_ip }}"
pve_ceph_device_id: nvme-KINGSTON_SNV2S2000G_50026B73825776AA
pve_ceph_storages:
  - name: cephfs
    type: cephfs
    content: [ "snippets", "iso", "vztmpl" ]
    nodes: "{{ groups['ceph'] }}"
    monhost: "{{ groups['ceph_mon'] }}"
    data: "cephfs"
  - name: rbd
    type: rbd
    content: [ "images", "rootdir" ]
    nodes: "{{ groups['ceph'] }}"
    monhost: "{{ groups['ceph_mon'] }}"
    pool: "{{ pve_ceph_pool_name }}"

# Configure network interfaces
network_config: |
  auto lo
  iface lo inet loopback

  iface {{ pve_primary_nic }} inet manual

  auto vmbr0
  iface vmbr0 inet static
          address {{ pxenode3_ip }}/24
          gateway {{ net_gateway }}
          bridge-ports {{ pve_primary_nic }}
          bridge-stp off
          bridge-fd 0

  auto {{ pve_ceph_nic }}
  iface {{ pve_ceph_nic }} inet static
          address {{ pxenode3_ceph_ip }}/24

# Set DNS servers
dns_servers: "{{ net_dns }}"

# Set hostname
set_hostname: pxenode3 # Hostname for the PXE node.
set_hostname_fqdn: "pxenode3.{{ pve_domain_name }}" # Fully Qualified Domain Name (FQDN).

# ZFS configuration
pve_zfs_enabled: true # Enable or disable ZFS support.
pve_zfs_create_pools: true # Enable or disable ZFS pool configuration.
pve_zfs_pool_name: "tank" # Name of the ZFS pool.
pve_zfs_manage_filesystem_permissions: true # Enable or disable filesystem permissions management.
pve_zfs_enable_nfs: true # Defines if NFS Kernel Server should be configured to serve NFS

pve_zfs_pools:
  - name: "{{ pve_zfs_pool_name }}"
    action: create
    options:
      ashift: 12
    compression: lz4
    devices:
      - ata-HGST_HTS725050A7E630_TF0500WJ0E3VHL
    mountpoint: "/export/zfs/"
    sharenfs: on
    state: present
    type: Single Disk
    add_storage: true # Add the ZFS pool as storage in Proxmox.

pve_zfs_create_filesystems: true # Defines if ZFS filesystem(s) are created
pve_zfs_filesystems:
  - name: "{{ inventory_hostname }}"
    atime: off
    compression: lz4
    group: nogroup
    mode: "0777" # Permissions for the filesystem.
    mountpoint: "/export/zfs/{{ inventory_hostname }}"
    owner: nobody
    pool: "{{ pve_zfs_pool_name }}"
    primarycache: all
    quota: none
    refquota: none
    recordsize: 16K
    sharenfs: on
    snapdev: visible
    snapdir: visible
    state: present

# Template configuration
templates:
  - name: "ubuntu-24.04"
    description: "Ubuntu 24.04 template for node 3"        # Description of the template.
    id_number: 9003                                        # Unique identifier for the template.
    machine_type: "q35"                                    # Machine type for the template.
    os_type: "l26"                                         # Operating system type.
    bios: "ovmf"                                           # BIOS type for the template.
    disk_size: "1g"                                        # Size of the disk for the template.
    memory: 1024                                           # Memory allocation for the template.
    vcpus: 1                                               # Number of virtual CPUs for the template.
    net_bridge: "vmbr0"                                    # Network interface for the template.
    net_type: "virtio"                                     # Network type for the template.
    scsihw: "virtio-scsi-pci"                              # SCSI hardware type for the template.
    storage: "local-lvm"                                   # Storage for the template.
    iso_image: "noble-server-cloudimg-amd64.img"           # ISO image for the template.
    vendor_file: "vendor-data.yaml"                        # Cloud-init vendor file for the template.
